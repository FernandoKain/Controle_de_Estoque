{% extends 'base.html' %}

{% block title %}Cadastrar Setor{% endblock %}

{% block content %}
  <div class="container mt-5">
    <h2 class="mb-4">🏢 Cadastrar Setor</h2>

      <!-- MENSAGENS FLASH -->
    {% with mensagens = get_flashed_messages(with_categories=true) %}
      {% if mensagens %}
        {% for categoria, mensagem in mensagens %}
          <div class="alert alert-{{ categoria }} alert-dismissible fade show" role="alert">
            {{ mensagem }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    <form method="POST">
      <div class="mb-3">
        <label for="nome" class="form-label">Nome do Setor:</label>
        <input type="text" class="form-control" id="nome" name="nome" required>
      </div>
      <button type="submit" class="btn btn-primary">Salvar</button>
    </form>

    <hr class="my-4">
    <h4>📁 Importar Setores via CSV</h4>
    <form method="POST" action="{{ url_for('importar_csv_setores') }}" enctype="multipart/form-data">
      <div class="mb-3">
        <label for="arquivo_csv" class="form-label">Arquivo CSV:</label>
        <input type="file" class="form-control" id="arquivo_csv" name="arquivo_csv" accept=".csv" required>
      </div>
      <button type="submit" class="btn btn-secondary">Importar</button>
    </form>
    
    <form method="GET" action="{{ url_for('exportar_csv_setores') }}" class="mt-3">
      <button type="submit" class="btn btn-outline-success">⬇️ Exportar Setores</button>
    </form>



    <hr class="my-4">

    <h4>Setores Cadastrados:</h4>
    <ul class="list-group">
      {% for setor in setores %}
        <!-- Completar código abaixo após incluir campo status -->
        {% if setor.status %}
          <li class="list-group-item d-flex justify-content-between align-items-center">
            {{ setor.nome }}
            <div class="btn-group">
              <form method="GET" action="{{ url_for('editar_setor', id=setor.id) }}" style="display:inline;">
                <button type="submit" class="btn btn-sm btn-primary">Editar</button>
              </form>
              <form method="POST" action="{{ url_for('desabilitar_setor', id=setor.id) }}" onsubmit="return confirm('Tem certeza que deseja desabilitar este Setor? (Essa ação não pode ser desfeita)')">
                <button type="submit" class="btn btn-sm btn-danger">Desabilitar</button>
              </form>
            </div>
          </li>
        {% else %}
          <!-- Exibir setor desabilitado
          <li class="list-group-item list-group-item-secondary d-flex justify-content-between align-items-center">
            {{ setor.nome }}<span class="badge bg-secondary">Desabilitado</span>
            <div class="btn-group">
              <form method="POST" action="{{ url_for('habilitar_setor', id=setor.id) }}" onsubmit="return confirm('Tem certeza que deseja habilitar este Setor?')">
                <button type="submit" class="btn btn-sm btn-success">Habilitar</button>
              </form>
            </div>
          </li> -->
        {% endif %}
      {% endfor %}
    </ul>
  </div>
{% endblock %}

